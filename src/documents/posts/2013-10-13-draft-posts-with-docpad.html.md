---
layout: post
title: "Draft Posts With DocPad"
date: 2013-10-13 13:52
published: true
comments: true
tags: DocPad
---

Here is a quick tip.  I use [DocPad](http://docpad.org) to [generate my blog](/2013/10/08/blogging-with-docpad/), and one of the things I was used to with OctoPress was the ability to have a number of draft blog posts in progress that would appear in development mode, but would not appear when I generated the production site.

DocPad _does_ recognize `draft`, `published`, `skip`, `ignore`, and `ignored` as metadata properties in a document, but those properties cause the document to be _completely_ ignored.  Even in development mode, a `draft: true` document will be invisible.  That wasn't what I wanted, so I took a different approach.

In my blog, any document in the `drafts/` subfolder is not included in any site index files when the site is generated with `docpad -e static generate`.

I accomplish this by defining a collection named `posts` in my `docpad.coffee`.  By default, the collection contains only the documents in the `posts/` subfolder.  But when run in development mode, the documents from `drafts/` are included in the collection and I sort them to the top so that they are always visible on the main blog index.

``` coffeescript-nojs
collections:
    posts: ->
        @getCollection('documents').findAllLive({relativeDirPath: 'posts'}, [date: -1])

environments:
    development:
        collections:
            posts: ->
                @getCollection('documents').findAllLive({relativeDirPath: {'$in' : ['posts', 'drafts']}}, [relativeDirPath: 1,  date: -1])
```

Now that there is a collection named `posts`, I use it in all of the places in the blog that loop over blog posts, and so each of those places automatically includes draft posts during development mode and leaves them out otherwise.  This includes all these places:

* The main [blog index](/)
* The [archives](/archives/) page
* [Tag index](/tags/docpad/) pages
* The [atom feed](/feed.xml)

There is an important second step, though.  Even though the draft posts are not includes in any indexes, they _are_ still being generated by docpad and so can be directly accessed if someone knows the URL.  I address this by doing two things.  First, I have the `drafts` folder in my [.gitignore](https://github.com/ervwalter/ewalnet-docpad/blob/master/src/documents/.gitignore) file, so that my draft documents only ever live on my own hard drive and don't get pushed to my [github repository](https://github.com/ervwalter/ewalnet-docpad/) or to my blog's host.  Keep in mind that my entire blog's working folder is in a [DropBox](https://db.tt/L0B0IUI) folder, so even though my draft posts aren't ever committed to git, they are available on _all_ of my computers and are effectively backed up to the cloud as well.

In normal circumstances, the `.gitignore` entry is sufficient, but I also have added `drafts` to the ignore list of my [Windows Azure deployment script](/2013/10/10/deploying-docpad-sites-to-azure/) as good measure just in case a draft document makes it into git somehow.